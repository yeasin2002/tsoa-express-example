# Setup Notes

## Important: Module Resolution

When using Bun with ES modules and tsoa, you must use explicit `.ts` extensions in your imports:

```typescript
// ✅ Correct
import { db } from "../lib/database.ts";
import type { User } from "../models/user.ts";

// ❌ Wrong (will cause module resolution errors)
import { db } from "../lib/database";
import type { User } from "../models/user";
```

## TypeScript Configuration

The `tsconfig.json` must be configured for ES modules:

```json
{
  "compilerOptions": {
    "module": "ESNext",
    "moduleResolution": "bundler"
  }
}
```

## Generating Routes

After making changes to controllers or models, regenerate the routes:

```bash
bun run build
# or
bun tsoa spec-and-routes
```

This will update:

- `src/routes.ts` - Express route handlers
- `public/openapi.json` - OpenAPI specification

## Database

The SQLite database is automatically created on first run with:

- WAL mode enabled for better performance
- Users table with email uniqueness constraint
- Todos table with foreign key to users (cascade delete)

## Project Structure

```
src/
├── controllers/       # API controllers with tsoa decorators
│   ├── user.controller.ts
│   └── todo.controller.ts
├── models/           # TypeScript interfaces
│   ├── user.ts
│   ├── todo.ts
│   └── error.ts
├── lib/              # Utilities
│   └── database.ts   # SQLite database setup
├── routes.ts         # Auto-generated by tsoa
└── server.ts         # Express server setup

public/
└── openapi.json      # Auto-generated OpenAPI spec

database.sqlite       # SQLite database file
```
